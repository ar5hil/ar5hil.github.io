function openPage(t,e){for(;t!=window.body&&!(t instanceof IOSTab);)t=t.parentElement;t instanceof IOSTab&&t.showNewPage(e)}function openTab(t,e){for(;t!=window.body&&!(t instanceof IOSApp);)t=t.parentElement;t instanceof IOSApp&&t.selectTab(e)}function loadSVG(t,e){if(t.trim().startsWith("<svg"))return e(t);fetch(t).then(t=>t.text()).then(e)}function createSVGElement(t){var e=document.createElement("template");return e.innerHTML=t.trim(),e.content.firstChild}function mirrorEvents(e,i,t){t.forEach(t=>{e.addEventListener(t,t=>i.dispatchEvent(new t.constructor(t.type,t)))})}let ignoreTimeStamp=0;function addPointerListener(t,e,i){let s="up"==e?[t,"mouseup",t,"touchend"]:0;"move"==e&&(s=[window,"mousemove",t,"touchmove"]),(s="down"==e?[t,"mousedown",t,"touchstart"]:s)[0].addEventListener(s[1],t=>{t.timeStamp!=ignoreTimeStamp&&i({clientX:t.clientX,clientY:t.clientY,pointerId:0,preventDefault:function(){t.preventDefault()}})}),s[2].addEventListener(s[3],t=>{ignoreTimeStamp=t.timeStamp;var e=t.changedTouches[0];i({clientX:e.clientX,clientY:e.clientY,pointerId:e.identifier,preventDefault:function(){t.preventDefault()}})})}class IOSElement extends HTMLElement{_watchChildren(e){new MutationObserver(t=>t.forEach(t=>t.addedNodes.forEach(e))).observe(this,{childList:!0}),[...this.children].forEach(e)}_watchAttribute(i,s,n=void 0){let a=this.hasAttribute(s)?this.getAttribute(s):n;i(a),new MutationObserver(t=>{var e=this.hasAttribute(s)?this.getAttribute(s):n;e!==a&&i(e),a=e}).observe(this,{attributes:!0,attributeFilter:[s]})}}class IOSApp extends IOSElement{static _cssCallbacks=[];static notifyCSS(){var t=[...document.styleSheets].find(t=>[...t.cssRules].find(t=>t.cssText.includes("i-app-detection-label"))),t=(document.adoptedStyleSheets?(IOSApp.css=new CSSStyleSheet,IOSApp.css.replace([...t.cssRules].map(t=>t.cssText).join("\n"))):IOSApp.css=[...t.cssRules].map(t=>t.cssText).join("\n"),IOSApp._cssCallbacks);IOSApp._cssCallbacks=void 0,t.forEach(t=>t())}static loadStyleSheet(t){IOSApp._cssCallbacks?IOSApp._cssCallbacks.push(t):t()}static addStyleToShadow(e){if(document.adoptedStyleSheets){var i=[IOSApp.css];for(let t=0;t<e.adoptedStyleSheets.length;t++)i.push(e.adoptedStyleSheets[t]);e.adoptedStyleSheets=i}else e.innerHTML+=`<style>${IOSApp.css}</style>`}connectedCallback(){this.initialized||(this.initialized=!0,IOSApp.loadStyleSheet(()=>{this.classList.add("i-root"),this._colorChangingElements=[],this._bindThemeChangingElement(this),["dark","light"].forEach(e=>window.matchMedia(`(prefers-color-scheme: ${e})`).addEventListener("change",t=>{t.matches&&"auto"==(this.getAttribute("theme")||"auto")&&(this._theme="i-theme-"+e,this._recalcTheme())})),this._watchAttribute(t=>{this._theme="auto"==t?window.matchMedia("(prefers-color-scheme: dark)").matches?"i-theme-dark":"i-theme-light":"i-theme-"+t,this._recalcTheme()},"theme","auto"),this.attachShadow({mode:"open"}),IOSApp.addStyleToShadow(this.shadowRoot),this.shadowRoot.innerHTML+=`
				<i-tabbar></i-tabbar>
				<slot></slot>
			`,this.bottomMenu=this.shadowRoot.querySelector("i-tabbar"),this.bottomMenu.bindApp(this),new ResizeObserver(t=>{this.getBoundingClientRect();this.classList.toggle("large-screen",600<=t[0].contentRect.width)}).observe(this),this._watchChildren(t=>{t instanceof IOSTab&&this._processBindTab(t)},!0),this.hasAttribute("manifest")&&this._loadFromManifest()}))}_recalcTheme(){this._colorChangingElements.forEach(e=>{[...e.classList].filter(t=>t.startsWith("i-theme")).forEach(t=>e.classList.remove(t)),e.classList.add(this._theme)})}_bindThemeChangingElement(t){this._colorChangingElements.push(t),this._recalcTheme()}_processBindTab(t){t._bindApp(this),!t.hasAttribute("selected")&&1!=this.tabsCount||this.selectTab(t.id)}_loadFromManifest(){fetch(this.getAttribute("manifest")).then(t=>t.json()).then(t=>{t.tabs.forEach(t=>{var e=document.createElement("i-tab");t.selected&&e.setAttribute("selected",""),t.id&&e.setAttribute("id",t.id),t.name&&e.setAttribute("name",t.name),t.page&&e.setAttribute("page",t.page),t.icon&&e.setAttribute("icon",t.icon),this.appendChild(e)})})}selectTab(t){t=this.querySelector("#"+t);this.selectedTab?.deselected(),(this.selectedTab=t).selected()}_animateTransition(i,s,n=t=>t){let a=new IOSAnimationId;var o=bezier(.2,.8,.2,1),r=Date.now(),c=this;this._transitionStarted(a,i),function t(){var e=(Date.now()-r)/s;1<=e?(c._processTransitionFrame(i,n(1)),c._transitionCompleted(a,i,1==n(1))):(c._processTransitionFrame(a,i,n(o(e))),requestAnimationFrame(t))}()}_transitionStarted(t,e){this._animationId=t,this.dispatchEvent(new CustomEvent("transition-started",{detail:{page:e}}))}_transitionCompleted(t,e,i){this._animationId==t&&this.dispatchEvent(new CustomEvent("transition-completed",{detail:{page:e,isEnd:i}}))}_processTransitionFrame(t,e,i){this._animationId==t&&(e.style.transform=`translateX(${100*(1-i)}%)`,e.prevPage.style.transform=`translateX(${-30*i}%)`,this.dispatchEvent(new CustomEvent("transition",{detail:{page:e,percent:i}})))}}class IOSAnimationId{}window.customElements.define("i-app",IOSApp);var NEWTON_ITERATIONS=4,NEWTON_MIN_SLOPE=.001,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1),float32ArraySupported="function"==typeof Float32Array;function A(e,r){return 1-3*r+3*e}function B(e,r){return 3*r-6*e}function C(e){return 3*e}function calcBezier(e,r,n){return((A(r,n)*e+B(r,n))*e+C(r))*e}function getSlope(e,r,n){return 3*A(r,n)*e*e+2*B(r,n)*e+C(r)}function binarySubdivide(e,r,n,t,i){for(var S,a,o=0;0<(S=calcBezier(a=r+(n-r)/2,t,i)-e)?n=a:r=a,Math.abs(S)>SUBDIVISION_PRECISION&&++o<SUBDIVISION_MAX_ITERATIONS;);return a}function newtonRaphsonIterate(e,r,n,t){for(var i=0;i<NEWTON_ITERATIONS;++i){var S=getSlope(r,n,t);if(0===S)return r;r-=(calcBezier(r,n,t)-e)/S}return r}function LinearEasing(e){return e}function bezier(a,r,o,n){if(!(0<=a&&a<=1&&0<=o&&o<=1))throw new Error("bezier x values must be in [0, 1] range");if(a===r&&o===n)return LinearEasing;for(var u=new(float32ArraySupported?Float32Array:Array)(kSplineTableSize),e=0;e<kSplineTableSize;++e)u[e]=calcBezier(e*kSampleStepSize,a,o);return function(e){return 0===e||1===e?e:calcBezier(function(e){for(var r=0,n=1,t=kSplineTableSize-1;n!==t&&u[n]<=e;++n)r+=kSampleStepSize;var i=r+(e-u[--n])/(u[n+1]-u[n])*kSampleStepSize,S=getSlope(i,a,o);return NEWTON_MIN_SLOPE<=S?newtonRaphsonIterate(e,i,a,o):0===S?i:binarySubdivide(e,r,r+kSampleStepSize,a,o)}(e),r,n)}}class IOSPage extends HTMLElement{_bindTab(t){this.tab=t,this.app=t.app,this.title=this.getAttribute("title")||"Untitled",this.titlebarType=this.getAttribute("titlebar")||"default",this.inverted="true"===this.getAttribute("inverted")||!1,this.path=this.getAttribute("path")||".",this.src=this.getAttribute("src")||void 0,this.inverted&&this.classList.add("inverted"),this.attachShadow({mode:"open"}),IOSApp.addStyleToShadow(this.shadowRoot),this.shadowRoot.innerHTML+=`
	    	<page-shadow>
	    		<i-titlebar-${this.titlebarType}></i-titlebar-${this.titlebarType}>
				<page-container>
					<page-header></page-header>
					<page-body>
						<slot></slot>
					</page-body>
				</page-scroll>
			</page-shadow>
		`;var e=t=>this.shadowRoot.querySelector(t);this.container=e("page-container"),this.header=e("page-header"),this.body=e("page-body"),this.titlebar=e("i-titlebar-"+this.titlebarType),mirrorEvents(this,t,["page-created","page-selected","page-deselected"]),this.app._bindThemeChangingElement(this),this.titlebar._bindPage(this),this._bindTouchGestures(),this.dispatchEvent(new CustomEvent("page-created",{detail:{page:this}})),this.src?this._loadContent():this._executePageScripts(),setTimeout(()=>{this.style.overflow="hidden"},500)}selected(){this.dispatchEvent(new CustomEvent("page-selected",{detail:{page:this}}))}deselected(){this.dispatchEvent(new CustomEvent("page-deselected",{detail:{page:this}}))}_loadContent(){fetch(this.src).then(t=>t.text()).then(t=>{this.innerHTML+=t,this._executePageScripts()})}_executePageScripts(){Array.from(this.querySelectorAll("script")).forEach(t=>{const e=document.createElement("script");Array.from(t.attributes).forEach(t=>{e.setAttribute(t.name,t.value)});var i=document.createTextNode(t.innerHTML);e.appendChild(i),t.parentNode.replaceChild(e,t)})}_bindTouchGestures(){this.gesture={started:!1,percent:0,startX:0,speed:0,currentX:0,lastX:0,width:0},addPointerListener(this,"down",t=>{var e=t.clientX-this.tab.getBoundingClientRect().left;void 0!==this.prevPage&&!this.gesture.pointerId&&e<25&&(this.gesture.started=!0,this.gesture.pointerId=t.pointerId,this.gesture.percent=0,this.gesture.startX=e,this.gesture.width=this.getBoundingClientRect().right-this.getBoundingClientRect().left,this.gesture.animationId=new IOSAnimationId,this.app._transitionStarted(this.gesture.animationId,this),this.app._processTransitionFrame(this.gesture.animationId,this,1),t.preventDefault())}),addPointerListener(this,"move",t=>{this.gesture.started&&this.gesture.pointerId===t.pointerId&&(this.gesture.previousX=this.gesture.currentX,this.gesture.currentX=t.clientX-this.tab.getBoundingClientRect().left,this.gesture.speed=this.gesture.currentX-this.gesture.previousX,this.gesture.percent=(this.gesture.currentX-this.gesture.startX)/this.gesture.width,this.app._processTransitionFrame(this.gesture.animationId,this,1-this.gesture.percent),t.preventDefault())}),addPointerListener(this,"up",t=>{var e;this.gesture.started&&this.gesture.pointerId==t.pointerId&&(this.gesture.started=!1,this.gesture.pointerId=0,.5<(e=this.gesture.percent)||5<this.gesture.speed?(this.app._animateTransition(this,400,t=>1-e-(1-e)*t),setTimeout(()=>{this.tab.removeChild(this),this.tab._setSelectedPage(this.prevPage)},400)):this.app._animateTransition(this,400,t=>1-e+e*t))})}}window.customElements.define("i-page",IOSPage);class IOSTab extends HTMLElement{static svgTemplate='<svg width="26" height="28" viewBox="0 0 26 28" xmlns="http://www.w3.org/2000/svg"><path d="m13.118 14.831c0.433 0 1.257-0.024 1.795-0.344l9.151-4.057c0.869-0.59 1.051-1.255 1.067-1.773 0.02-0.662-0.313-1.634-1.181-2.15l-8.515-3.921c-0.537-0.309-2.096-0.552-2.529-0.552-0.444 0-1.958 0.42-2.496 0.73l-8.643 4.034c-0.85 0.602-1.022 1.284-0.951 1.942 0.098 0.887 0.206 0.857 0.889 1.503l9.577 4.212c0.537 0.32 1.391 0.376 1.836 0.376zm-0.12 5.467c0.403 0 1.443-0.068 1.928-0.345l8.858-3.991c0.497-0.3 1.448-1.117 1.382-1.952-0.091-1.138-0.598-1.7-0.948-1.906l-9.22 3.888c-0.454 0.261-1.417 0.478-1.916 0.478-0.542 0-1.539-0.228-1.766-0.362l-9.395-4.012c-0.462 0.022-1.174 0.911-1.201 1.642-0.03 0.761 0.7 1.62 1.135 1.839l9.408 4.384c0.485 0.278 1.322 0.337 1.735 0.337zm0.09 5.344c0.403 0 1.296-0.053 1.781-0.342l9.147-4.299c0.485-0.289 1.129-0.789 1.053-1.879-0.056-0.794-0.071-1.123-0.918-1.765l-9.203 4.113c-0.228 0.134-0.948 0.39-1.853 0.39-0.939 0-1.603-0.224-1.831-0.359l-9.451-4.017c-0.979 0.247-1.005 1.45-1.005 1.947 0 0.455 0.403 1.279 0.9 1.568l9.465 4.262c0.486 0.29 1.502 0.381 1.915 0.381z" fill="currentColor"/></svg>';static tabCounter=0;_bindApp(e){this.app=e,this.id||(this.id="tab_"+IOSTab.tabCounter++),this.name||(this.name=this.getAttribute("name")||"Unnamed"),this.icon||(this.icon=this.getAttribute("icon")||IOSTab.svgTemplate),mirrorEvents(this,e,["tab-created","tab-selected","tab-deselected","page-created","page-selected","page-deselected"]),this.attachShadow({mode:"open"}),IOSApp.addStyleToShadow(this.shadowRoot),this.shadowRoot.innerHTML+=`
			<i-titlebar-root></i-titlebar-root>
			<slot></slot>
		`,this.titlebarRoot=this.shadowRoot.querySelector("i-titlebar-root"),this.titlebarRoot._bindTab(this),new MutationObserver(e=>e.forEach(e=>e.addedNodes.forEach(e=>{e instanceof IOSPage&&(e.prevPage=this.selectedPage,e._bindTab(this),void 0!==e.prevPage&&this.app._animateTransition(e,600),this._setSelectedPage(e))}))).observe(this,{childList:!0}),this.dispatchEvent(new CustomEvent("tab-created",{detail:{tab:this}})),this.getAttribute("page")&&this.showNewPage(this.getAttribute("page"))}showNewPage(a){var e=this.app.querySelector(`template[path="${a}"]`);if(e){const t=document.createElement("i-page");t.innerHTML=e.innerHTML,[...e.attributes].forEach(e=>t.setAttribute(e.nodeName,e.nodeValue)),this.appendChild(t)}else fetch(a+".template").then(e=>e.text()).then(e=>{var t=document.createElement("template"),i=(t.innerHTML=e.trim(),t=t.content.firstChild,document.createElement("i-page"));i.setAttribute("src",a+".html"),i.setAttribute("path",a.replaceAll("/","-")),i.innerHTML=t.innerHTML,[...t.attributes].forEach(e=>i.setAttribute(e.nodeName,e.nodeValue)),this.appendChild(i)})}goToPreviousPage(e=this.selectedPage.prevPage){var t=this.selectedPage;this.app._animateTransition(t,400,e=>1-e),setTimeout(()=>{this._removePage(t),this._setSelectedPage(e)},400)}selected(){this.setAttribute("selected",""),this.dispatchEvent(new CustomEvent("tab-selected",{detail:{tab:this}}))}deselected(){this.removeAttribute("selected"),this.dispatchEvent(new CustomEvent("tab-deselected",{detail:{tab:this}}))}_setSelectedPage(e){this.selectedPage?.deselected(),(this.selectedPage=e).selected()}_removePage(e){this.removeChild(e)}}window.customElements.define("i-tab",IOSTab);class IOSTabbar extends HTMLElement{connectedCallback(){this.classList.add("i-material-chrome"),this.classList.add("i-root")}bindApp(e){var a=this;(this.app=e)._bindThemeChangingElement(this),e.addEventListener("tab-created",e=>{var t=document.createElement("i-tabbar-item");t.id="tabbar_"+e.detail.tab.id,t.tab=e.detail.tab,t.addEventListener("click",()=>a.app.selectTab(t.tab.id)),this.appendChild(t)}),e.addEventListener("tab-selected",e=>{a.selectedItem?.classList.remove("selected"),a.selectedItem=this.querySelector("#tabbar_"+e.detail.tab.id),a.selectedItem.classList.add("selected")})}}class IOSTabbarItem extends HTMLElement{connectedCallback(){this.innerHTML=`
			<div id="tab-icon-container">
				<svg id="tabbar-loading-svg"></svg>
			</div>
			<div id="tab-title">${this.tab.name}</div>
	    `,loadSVG(this.tab.icon,e=>{this.querySelector("#tabbar-loading-svg").replaceWith(createSVGElement(e))})}}window.customElements.define("i-tabbar",IOSTabbar),window.customElements.define("i-tabbar-item",IOSTabbarItem);class StyleTransition{constructor(t,e,i){const a=this;function n(i){var t;return void 0!==i.source&&(e("scale","none"==(t=getComputedStyle(i.source)).scale?1:t.scale),e("width",s(t.width)),e("height",s(t.height)),e("opacity",t.opacity),e("fontWeight",t.fontWeight),e("fontSize",s(t.fontSize)),e("padding",s([t.paddingTop,t.paddingRight,t.paddingBottom,t.paddingLeft])),e("borderRadius",s([t.borderTopLeftRadius,t.borderTopRightRadius,t.borderBottomRightRadius,t.borderBottomLeftRadius])),e("translate",s([t.translateX,t.translateY])),e("backgroundColor",o(t.backgroundColor)),e("color",o(t.color))),i;function e(t,e){void 0===i[t]&&(i[t]=e)}}function s(t){return t instanceof Array?t.map(parseFloat):parseFloat(t)}function o(t){t=t.replace(/^rgba?\(|\s+|\)$/g,"").split(",");return 3==t.length&&t.push("1"),t}function l(t,e,i=t=>t){return a.target.style[t]=i(function(t,i){var e=a.from[t];const n=a.to[t];return e==n?e:e instanceof Array?e.map((t,e)=>t-(t-n[e])*i):e-(e-n)*i}(t,e)),a}this.target=t,this.from=n(e),this.to=n(i),this.scale=t=>l("scale",t),this.width=t=>l("width",t,t=>t+"px"),this.height=t=>l("height",t,t=>t+"px"),this.opacity=t=>l("opacity",t),this.fontWeight=t=>l("fontWeight",t),this.padding=t=>l("padding",t,t=>`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px`),this.borderRadius=t=>l("borderRadius",t,t=>`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px`),this.backgroundColor=t=>l("backgroundColor",t,t=>`rgba(${t[0]},${t[1]},${t[2]},${t[3]})`),this.color=t=>l("color",t,t=>`rgba(${t[0]},${t[1]},${t[2]},${t[3]})`),this.translate=t=>l("translate",t,t=>`${t[0]}px ${t[1]}px`),this.fontSize=t=>l("fontSize",t),this.$fontScale=(t,e)=>{var i=e?a.from.fontSize/a.to.fontSize:a.to.fontSize/a.from.fontSize;return a.target.style.scale=1-(1-i)*(e?1-t:t),this}}}class IOSTitlebarRoot extends HTMLElement{static arrowIcon=`
		<svg {meta} viewBox="0 0 12 20" xmlns="http://www.w3.org/2000/svg">
			<path fill="currentColor" d="M0.610352 10.0068C0.615885 9.81315 0.654622 9.63607 0.726562 9.47559C0.798503 9.3151 0.90918 9.16016 1.05859 9.01074L9.37598 0.958984C9.61393 0.721029 9.90723 0.602051 10.2559 0.602051C10.4883 0.602051 10.6986 0.657389 10.8867 0.768066C11.0804 0.878743 11.2326 1.02816 11.3433 1.21631C11.4595 1.40446 11.5176 1.61475 11.5176 1.84717C11.5176 2.19027 11.3875 2.49186 11.1274 2.75195L3.60693 9.99854L11.1274 17.2534C11.3875 17.519 11.5176 17.8206 11.5176 18.1582C11.5176 18.3962 11.4595 18.6092 11.3433 18.7974C11.2326 18.9855 11.0804 19.1349 10.8867 19.2456C10.6986 19.3618 10.4883 19.4199 10.2559 19.4199C9.90723 19.4199 9.61393 19.2982 9.37598 19.0547L1.05859 11.0029C0.903646 10.8535 0.790202 10.6986 0.718262 10.5381C0.646322 10.3721 0.610352 10.195 0.610352 10.0068Z"/>
		</svg>
	`;_bindTab(t){this.tab=t;this.animation={},this.innerHTML=`
			<div id="anim-title-1" class="anim-element"></div>
			<div id="anim-title-2" class="anim-element"></div>
			<div id="anim-back-1" class="anim-element"></div>
			<div id="anim-back-2" class="anim-element"></div>
			${IOSTitlebarRoot.arrowIcon.replace("{meta}",'id="anim-back-arrow" class="anim-element"')}
			<div id="anim-tools" class="anim-element"></div>
		`,this.title1=this.querySelector("#anim-title-1"),this.title2=this.querySelector("#anim-title-2"),this.back1=this.querySelector("#anim-back-1"),this.back2=this.querySelector("#anim-back-2"),this.backArrow=this.querySelector("#anim-back-arrow"),this.tools=this.querySelector("#anim-tools"),this.tab.app._bindThemeChangingElement(this),this.tab.app.addEventListener("transition-started",t=>{var e,i,n;this.tab.hasAttribute("selected")&&(e=(t=t.detail.page).prevPage.titlebar,n=t.titlebar,this.animation.started=!0,this.animation.equalTools=e.getToolsElementHTML()===n.getToolsElementHTML(),this._switchElementsVisibility(t,!1),i=t=>[t.left,t.top],this.animation.title1Transition=new StyleTransition(this.title1,{source:e.getTitleElement(),translate:i(e.getTitleElementPosition())},{source:n.getBackTextElement(),translate:i(n.getBackTextElementPosition()),opacity:0}),this.animation.title2Transition=new StyleTransition(this.title2,{translate:i(n.getHiddenTitleElementPosition()),opacity:getComputedStyle(n.getTitleElement()).opacity},{translate:i(n.getTitleElementPosition()),opacity:0}),this.animation.back1Transition=new StyleTransition(this.back1,{translate:i(e.getBackTextElementPosition()),opacity:getComputedStyle(e.getBackTextElement()).opacity},{translate:i(e.getHiddenBackTextElementPosition()),opacity:0}),this.animation.back2Transition=new StyleTransition(this.back2,{source:e.getTitleElement(),translate:i(e.getTitleElementPosition()),opacity:0},{source:n.getBackTextElement(),translate:i(n.getBackTextElementPosition())}),this.animation.backArrowTransition=new StyleTransition(this.backArrow,{source:e.getBackArrowElement(),translate:i(e.getBackArrowElementPosition())},{source:n.getBackArrowElement(),translate:i(n.getBackArrowElementPosition())}),this._cloneTextStyle(this.title1,e.getTitleElement()),this._cloneTextStyle(this.title2,n.getTitleElement()),this._cloneTextStyle(this.back1,e.getBackTextElement()),this._cloneTextStyle(this.back2,n.getBackTextElement()),this._cloneTextStyle(this.backArrow,n.getBackArrowElement()),this.animation.equalTools?(i=n.getToolsElementPosition(),n=getComputedStyle(e.getToolsElement()),this.tools.innerHTML=e.getToolsElementHTML(),this.tools.style.width=i.right-i.left-parseFloat(n.paddingRight),this.tools.style.translate=`${i.left}px ${i.top}px`):this.tools.innerHTML="",this._switchElementsVisibility(t,!0))}),this.tab.app.addEventListener("transition-completed",t=>{this.tab.hasAttribute("selected")&&(this.animation.started=!1,this._switchElementsVisibility(t.detail.page,!1))}),this.tab.app.addEventListener("transition",t=>{this.animation.started&&this.calcTransition(t.detail.page,t.detail.percent)}),this._switchElementsVisibility(null,!1)}calcTransition(t,e){t=t.prevPage.titlebar;this.animation.title1Transition.translate(e).opacity(1.7*e).fontWeight(e).$fontScale(e,!1),this.animation.title2Transition.translate(e).opacity(1.5*(1-e)),this.animation.back1Transition.translate(e).opacity(2*e),this.animation.back2Transition.translate(e).opacity(1.7*e-.7).fontWeight(e).$fontScale(e,!0),this.animation.backArrowTransition.scale(e).padding(e).width(e).height(e).opacity(t.backArrowOpacityFunc(e)).translate(e).backgroundColor(e).borderRadius(e).color(e)}_cloneTextStyle(t,e){var i=getComputedStyle(e);t.style.color=i.color,t.style.fontSize=i.fontSize,t.style.fontWeight=i.fontWeight,t.style.letterSpacing=i.letterSpacing,t.innerHTML=e.innerHTML}_switchElementsVisibility(t,e){const i="top-menu-anim-invisible";var n;[this.title1,this.title2,this.back1,this.back2,this.backArrow,this.tools].forEach(t=>t.classList.toggle(i,!e)),null!=t&&(n=t.prevPage.titlebar,t=t.titlebar,[n.getTitleElement(),t.getTitleElement(),n.getBackTextElement(),t.getBackTextElement(),n.getBackArrowElement(),t.getBackArrowElement(),this.animation.equalTools?t.getToolsElement():null,this.animation.equalTools?n.getToolsElement():null].forEach(t=>t?.classList.toggle(i,e)))}}class IOSTitlebar extends HTMLElement{_bindPage(t){this.page=t,this.classList.add("titlebar"),this.page.app._bindThemeChangingElement(this),this.backArrowOpacityFunc=t=>t}_getTextPosition(t){var e;return(""==t.innerHTML?t:((e=document.createRange()).setStart(t,0),e.setEnd(t,1),e)).getBoundingClientRect()}_getElementRect(t){for(var e=t.getBoundingClientRect(),i={left:0,top:0,right:0,bottom:0};i.left+=t.offsetLeft,i.top+=t.offsetTop,(t=t.offsetParent)!==this.page.app;);return i.right=i.left+(e.right-i.left),i.bottom=i.top+(e.bottom-i.top),i}_relativeToApp(t){var e=this.page.getBoundingClientRect();return{left:t.left-e.left,top:t.top-e.top,right:t.right-e.left,bottom:t.bottom-e.top}}addClass(t){this.classList.add(t)}getTitleElement(){}getTitleElementPosition(){}getHiddenTitleElementPosition(){}getBackTextElement(){}getBackTextElementPosition(){}getHiddenBackTextElementPosition(){}getBackArrowElement(){}getBackArrowElementPosition(){}getToolsElement(){}getToolsElementHTML(){}getToolsElementPosition(){}onPageScroll(t){}}class DefaultTitlebar extends IOSTitlebar{_bindPage(t){super._bindPage(t),this.addClass("titlebar-default"),this.innerHTML+=`
			<div id="content-container">
				<div id="statusbar"></div>
				<div id="controls-container">
					<div id="back-container">
						<div id="back-arrow">
							${IOSTitlebarRoot.arrowIcon.replace("{meta}","")}
						</div>
						<div id="back-text">${this.page.prevPage?.title??"-"}</div>
					</div>
					<div id="title">${this.page.title}</div>
					<div id="tools-container">
						<slot name="tools"></slot>
					</div>
				</div>
			</div>
			<div id="background" class="i-material-chrome"></div>
		`,this.statusbarElement=this.querySelector("#statusbar"),this.titleElement=this.querySelector("#title"),this.toolsContainerElement=this.querySelector("#tools-container"),this.backContainerElement=this.querySelector("#back-container"),this.backTextElement=this.querySelector("#back-text"),this.backArrowElement=this.querySelector("#back-arrow"),this.backgroundElement=this.querySelector("#background"),this.page.container.addEventListener("scroll",t=>this.onPageScroll(this.page.container.scrollTop)),addPointerListener(this,"down",t=>{t.preventDefault(),this.backContainerElement.classList.add("pressed")}),addPointerListener(this,"up",t=>{t.preventDefault(),this.backContainerElement.classList.remove("pressed"),this.page.tab.goToPreviousPage()}),void 0===this.page.prevPage&&(this.backTextElement.style.opacity=0,this.backArrowElement.style.opacity=0)}getTitleElement(){return this.titleElement}getTitleElementPosition(){return this._relativeToApp(this._getTextPosition(this.getTitleElement()))}getHiddenTitleElementPosition(){var t=this.page.app.getBoundingClientRect(),e=(this.page.getBoundingClientRect(),this._getTextPosition(this.getTitleElement()));return{left:t.right-t.left-(e.right-e.left),top:e.top-t.top}}getBackTextElement(){return this.backTextElement}getBackTextElementPosition(){return this._relativeToApp(this._getTextPosition(this.getBackTextElement()))}getHiddenBackTextElementPosition(){var t=this.getBackTextElementPosition();return t.left-=100,t}getBackArrowElement(){return this.backArrowElement}getBackArrowElementPosition(){return this._getElementRect(this.getBackArrowElement())}getToolsElement(){return this.toolsContainerElement}getToolsElementHTML(){return[...this.toolsContainerElement.children[0].assignedNodes()].map(t=>t.outerHTML.trim()).join("\n")}getToolsElementPosition(){return this._getElementRect(this.getToolsElement())}onPageScroll(t){}}class TitledTitlebar extends DefaultTitlebar{_bindPage(t){super._bindPage(t),this.addClass("titlebar-titled"),this.page.header.innerHTML=`
			<div id="header-title-container">
				<div id="header-title">${this.page.title}</div>
			</div>
		`,this.titleHeaderElement=this.page.header.querySelector("#header-title"),this.onPageScroll(0),this.backArrowOpacityFunc=t=>this.headerPositionPercent<1?2*t-1:t}getTitleElement(){return this.headerPositionPercent<1?this.titleHeaderElement:super.getTitleElement()}getHiddenTitleElementPosition(){var t,e;return this.headerPositionPercent<1?(t=this.getTitleElementPosition(),e=this.page.app.getBoundingClientRect(),{left:t.left+(e.right-e.left),top:t.top}):super.getHiddenTitleElementPosition()}onPageScroll(t){var e=this._relativeToApp(this._getTextPosition(this.titleHeaderElement)),i=this.getBoundingClientRect(),e=e.bottom-7,i=i.bottom-i.top;this.headerPositionPercent=t/(e+t-i),this.backgroundElement.style.opacity=this.headerPositionPercent,this.titleElement.style.opacity=this.headerPositionPercent<1?"0":"",this.titleElement.style.visibility=this.headerPositionPercent<1?"hidden":"",null==this.page.prevPage?(this.backArrowElement.style.scale=this.headerPositionPercent<1?"0":"1",this.backArrowElement.style.opacity="0"):(this.backArrowElement.style.scale="",this.backArrowElement.style.opacity=""),this.titleHeaderElement.style.scale=t<0?Math.min(1.2,1+t/-200*.2):""}}class ImageTitlebar extends DefaultTitlebar{_bindPage(t){super._bindPage(t),this.addClass("titlebar-image"),this.imageSrc=t.getAttribute("imageSrc")||"",this.imageHeaderElement=document.createElement("div"),this.imageHeaderElement.id="header-image",this.imageHeaderElement.style.setProperty("--image-src",`url("${this.imageSrc}")`),this.page.header.appendChild(this.imageHeaderElement),this.onPageScroll(0)}onPageScroll(t){this.imageHeaderElement.style.height=`calc(var(--i-image-header-height) - ${t-10}px)`,this.headerPositionPercent=t/200;t=.5<this.headerPositionPercent;this.backArrowElement.classList.toggle("light",!t),this.backTextElement.style.opacity=t?"":"0",this.backgroundElement.style.opacity=this.headerPositionPercent,this.titleElement.style.opacity=this.headerPositionPercent,this.statusbarElement.style.opacity=this.headerPositionPercent}}class IOSToolItem extends DefaultTitlebar{connectedCallback(){this.addEventListener("touchstart",t=>{t.preventDefault(),t.stopPropagation(),this.classList.add("pressed")}),this.addEventListener("touchend",t=>{t.preventDefault(),t.stopPropagation(),this.classList.remove("pressed")})}}window.customElements.define("i-titlebar-root",IOSTitlebarRoot),window.customElements.define("i-titlebar-default",DefaultTitlebar),window.customElements.define("i-titlebar-titled",TitledTitlebar),window.customElements.define("i-titlebar-image",ImageTitlebar),window.customElements.define("i-tools-item",IOSToolItem);class AppElement extends HTMLElement{connectedCallback(){this.innerHTML=`
			<div id="header">
				<div id="image" style="background-image: url('resources/image1.jpg');"></div>
			</div>
			<div id="body">
				<div id="app-about">
					<div id="app-title">Кошки и суп</div>
					<div id="app-description">Все с кошками</div>
				</div>
				<div id="action">
					<div id="button">ЗАГРУЗИТЬ</div>
				</div>
			</div>
			
		`}}window.customElements.define("app-element",AppElement);class IOSCheckbox extends HTMLElement{connectedCallback(){var t=this.selected=!1;this.addEventListener("touchstart",e=>{e.preventDefault(),this.startX=e.changedTouches[0].clientX,this.startY=e.changedTouches[0].clientY,this.classList.add("active"),t=!1}),this.addEventListener("touchend",e=>{e.preventDefault(),this.classList.remove("active"),t||(this.selected=!this.selected,this.classList.toggle("selected",this.selected)),this.#invokeEvent()}),this.addEventListener("touchmove",e=>{e.preventDefault(),t=!0,this.classList.toggle("active",Math.hypot(this.startX-e.changedTouches[0].clientX,this.startY-e.changedTouches[0].clientY)<100),this.selected=e.changedTouches[0].clientX>this.startX,this.classList.toggle("selected",this.selected)}),this.addEventListener("click",e=>{this.selected=!this.selected,this.classList.toggle("selected",this.selected),this.#invokeEvent()})}#invokeEvent(){this.dispatchEvent(new CustomEvent("change",{detail:{target:this}}))}}window.customElements.define("ios-checkbox",IOSCheckbox);class HorizontallScroll extends HTMLElement{connectedCallback(){this.childNodes.forEach(e=>{var l;void 0!==e.outerHTML&&((l=document.createElement("horizontal-scroll-element")).innerHTML=e.outerHTML,e.parentNode.replaceChild(l,e))})}}class HorizontallScrollElement extends HTMLElement{}window.customElements.define("horizontal-scroll",HorizontallScroll),window.customElements.define("horizontal-scroll-element",HorizontallScrollElement);class HorizontallTitledScroll extends HTMLElement{connectedCallback(){this.innerHTML=`
			<div id="head">
				<div id="head_left">
					<div id="title">Избранное</div>
					<div id="description">Подборка от редакторов</div>
				</div>
				<div id="head_right">
					<div id="more">См. все</div>
				</div>
			</div>
			<div id="blocks">${this.innerHTML}</div>
		`}}class HorizontallTitledScrollElement extends HTMLElement{}window.customElements.define("horizontal-titled-scroll",HorizontallTitledScroll);class SearchBox extends HTMLElement{connectedCallback(){this.innerHTML+=`
			<div id="search-icon">
				<svg-loader src="${this.getAttribute("icon")}"></svg-loader>
			</div>
			<input placeholder="${this.getAttribute("placeholder")}">
		`}}window.customElements.define("search-box",SearchBox);class TableView extends HTMLElement{connectedCallback(){this.attachShadow({mode:"open"}),IOSApp.addStyleToShadow(this.shadowRoot),this.shadowRoot.innerHTML+=`
	    	<table-view-shadow>
		    	<div id="title">
		    		<div id="title-text">
		    			<slot name="title"></slot>
		    		</div>
		    		<div id="title-icon">
		    			<svg width="8" height="12" viewBox="0 0 8 12" xmlns="http://www.w3.org/2000/svg">
							<path d="M7.5166 6.00684C7.5166 6.15072 7.48893 6.28353 7.43359 6.40527C7.37826 6.52702 7.29248 6.646 7.17627 6.76221L2.2041 11.6846C2.02148 11.8672 1.80013 11.9585 1.54004 11.9585C1.26888 11.9585 1.03923 11.8672 0.851074 11.6846C0.662923 11.4964 0.568848 11.2695 0.568848 11.0039C0.568848 10.7383 0.671224 10.5031 0.875977 10.2983L5.23389 6.00684L0.875977 1.71533C0.671224 1.51058 0.568848 1.27539 0.568848 1.00977C0.568848 0.744141 0.662923 0.52002 0.851074 0.337402C1.03923 0.149251 1.26888 0.0551758 1.54004 0.0551758C1.80013 0.0551758 2.02148 0.146484 2.2041 0.329102L7.17627 5.25146C7.40316 5.46729 7.5166 5.71908 7.5166 6.00684Z" fill="currentColor"/>
						</svg>
		    		</div>
		    	</div>
		    	<div id="content-wrapper">
		    		<div id="content">
		    			<slot name="header"></slot>
				    	<slot id="content-slot"></slot>
				    	<slot name="footer"></slot>
		    		</div>
		    	</div>
	    	</table-view-shadow>
	    `,this.titleSlot=this.shadowRoot.querySelector('slot[name="title"]'),this.titleElement=this.shadowRoot.querySelector("#title"),this.shadowElement=this.shadowRoot.querySelector("table-view-shadow"),this.titleSlot.addEventListener("slotchange",t=>{this.shadowElement.classList.toggle("collapsable",0<this.titleSlot.assignedNodes().length)}),this.titleElement.addEventListener("click",t=>{const e=this.shadowElement.classList.contains("collapsed");this.shadowElement.style.setProperty("--full-height",this.shadowRoot.querySelector("#content").scrollHeight+"px"),setTimeout(()=>{this.shadowElement.classList.toggle("collapsed",!e)},1)}),this.shadowRoot.querySelector("#content").addEventListener("transitionend",t=>{this.shadowElement.classList.contains("collapsed")||this.shadowElement.style.removeProperty("--full-height")})}animate(o,l,i=performance.now()){const s=this,a=(this.animationId=this.animationId||0,++this.animationId);requestAnimationFrame(function t(e){e=Math.min((e-i)/o,1);l(e),e<1&&a==s.animationId&&requestAnimationFrame(t)})}}class TableCell extends IOSElement{connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
	    	<style>
	    		#item {
	    			min-height: 33pt;
	    			display: flex;
	    			font-size: 17px;
	    			letter-spacing: -0.4px;
	    			font-weight: 400;
	    		}

	    		slot[name="icon"]{
	    			margin-left: 16px;
	    			display: flex;
	    			align-items: center;
	    		}

	    		#content {
	    			padding-right: 16px;
	    			border-bottom: 0.5px solid var(--border-color);
	    			display: flex;
	    			align-items: center;
	    			flex: 1;
	    			gap: 16px;
	    		}

	    		#content-slot {
	    			display: flex;
	    			flex: 1;
	    		}

	    		slot[name="detail"]{
	    			display: flex;
	    			align-items: center;
	    			color: var(--i-text-2);
	    			gap: 16px;
	    		}
	    	</style>
	    	<div id="item">
		        <slot name="icon"></slot>
		        <div id="content">
		        	<slot id="content-slot"></slot>
		        	<slot name="detail"></slot>
		        </div>
	      	</div>
	    `,this.addClickEvents();for(var t=["chevron",()=>new ChevronCellDecorator,"switch",()=>new SwitchCellDecorator,"radio",()=>new RadioCellDecorator,"button",()=>new ButtonCellDecorator],e=0;e<t.length;e+=2)if(this.getAttributeNames().includes(t[e])){t[e+1]().applyCell(this);break}}addClickEvents(){this.clickable=!1;this.shadowRoot.querySelector("#item");this.addEventListener("touchstart",t=>{this.clickable&&this.classList.add("active")}),this.addEventListener("touchend",t=>{this.classList.remove("active")}),this.addEventListener("click",t=>{this.hasAttribute("nextPage")&&openPage(this,this.getAttribute("nextPage"))})}getContent(){return""}}class ChevronCellDecorator{applyCell(t){t.clickable=!0,t.shadowRoot.querySelector("#content").innerHTML+=`
			<style>
				#arrow {
					color: var(--i-text-3);
				}
			</style>
			<svg id="arrow" width="8" height="32" viewBox="0 0 8 32" xmlns="http://www.w3.org/2000/svg">
				<path fill="currentColor" d="M7.84961 16.0068C7.84961 16.1507 7.82194 16.2835 7.7666 16.4053C7.71126 16.527 7.62549 16.646 7.50928 16.7622L2.53711 21.6846C2.35449 21.8672 2.13314 21.9585 1.87305 21.9585C1.60189 21.9585 1.37223 21.8672 1.18408 21.6846C0.995931 21.4964 0.901855 21.2695 0.901855 21.0039C0.901855 20.7383 1.00423 20.5031 1.20898 20.2983L5.56689 16.0068L1.20898 11.7153C1.00423 11.5106 0.901855 11.2754 0.901855 11.0098C0.901855 10.7441 0.995931 10.52 1.18408 10.3374C1.37223 10.1493 1.60189 10.0552 1.87305 10.0552C2.13314 10.0552 2.35449 10.1465 2.53711 10.3291L7.50928 15.2515C7.73617 15.4673 7.84961 15.7191 7.84961 16.0068Z"/>
			</svg>
		`}}class SwitchCellDecorator{applyCell(t){t.innerHTML+='<ios-checkbox slot="detail"></ios-checkbox>'}}class RadioCellDecorator{static groups=new Object;applyCell(e){e.clickable=!0,e.select=()=>{RadioCellDecorator.groups[e.groupName]?.shadowItem.classList.remove("selected"),(RadioCellDecorator.groups[e.groupName]=e).shadowItem.classList.add("selected"),e.dispatchEvent(new CustomEvent("change",{detail:{target:e}}))},e.groupName=e.getAttribute("group"),e.shadowItem=e.shadowRoot.querySelector("#item"),e._watchAttribute(t=>{""===t&&e.select()},"selected"),e.addEventListener("click",t=>{e.select()}),e.shadowRoot.querySelector("#content").innerHTML+=`
			<style>
				#check {
					display: none;
					color: var(--i-accent);
				}
				#item.selected #check {
					display: initial;
				}
			</style>
			<svg id="check" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
				<path fill="currentColor" d="M6.29004 15.4692C6.78255 15.4692 7.16162 15.2673 7.42725 14.8633L15.1968 2.84375C15.2909 2.69987 15.36 2.56152 15.4043 2.42871C15.4486 2.2959 15.4707 2.16309 15.4707 2.03027C15.4707 1.70378 15.3628 1.43538 15.147 1.2251C14.9312 1.01481 14.6545 0.909668 14.3169 0.909668C14.0845 0.909668 13.8908 0.956706 13.7358 1.05078C13.5809 1.13932 13.4315 1.29427 13.2876 1.51562L6.25684 12.6553L2.6543 8.08984C2.39421 7.76335 2.07324 7.6001 1.69141 7.6001C1.35384 7.6001 1.07438 7.70801 0.853027 7.92383C0.631673 8.13965 0.520996 8.41357 0.520996 8.74561C0.520996 8.89502 0.545898 9.0389 0.595703 9.17725C0.651042 9.31559 0.739583 9.45671 0.861328 9.60059L5.16113 14.8965C5.47103 15.2783 5.84733 15.4692 6.29004 15.4692Z"/>
			</svg>
		`}}class ButtonCellDecorator{applyCell(t){t.clickable=!0,t.shadowRoot.querySelector("#content").innerHTML+=`
			<style>
				#content-slot {
					justify-content: var(--justify-content);
				}
				#content {
					gap: var(--gap);
				}
			</style>
		`}}window.customElements.define("table-view",TableView),window.customElements.define("table-cell",TableCell);class TitledImage extends HTMLElement{connectedCallback(){this.innerHTML=`
			<div id="l1">в поисках вдохновения</div>
			<div id="l2">April - Пазлы по номерам</div>
			<div id="l3">Собирайте необычные пазлы</div>
			<div id="auto-ratio">
				<img id="image" src="resources/image.jpg" onclick="document.querySelector('ios-app').showNewPage('pages/test')"/>
			</div>
		`}}window.customElements.define("titled-image",TitledImage);class VerticalList extends HTMLElement{connectedCallback(){}}window.customElements.define("vertical-list",VerticalList);class SVGLoader extends HTMLElement{connectedCallback(){var e=this.getAttribute("src");let o=this;fetch(e).then(e=>e.text()).then(e=>{(t=document.createElement("template")).innerHTML=e.trim();for(var t=t.content.firstChild,n=0,a=o.attributes;n<a.length;n++)t.setAttribute(a[n].nodeName,a[n].nodeValue);o.parentNode.replaceChild(t,o),o.onSVGLoad&&o.onSVGLoad(t)})}}window.customElements.define("svg-loader",SVGLoader);